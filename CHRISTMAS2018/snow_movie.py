
groundstr='''
................................................................
................................................................
................................................................
................................................................
................................................................
................................................................
................................................................
................................................................
----------------------------------------------------------------
................................................................
................................................................
................................................................
................................................................
................................................................
................................................................
.......................................................111111...
12...1..................1111111......................12121121111
----------------------------------------------------------------
1121111311......11...12112111111111211....211....111111111111111
1111121111111311111111111121111111111111111111111211111111111111
1111111111111111211131111111111112111111111111111111112111121111
1111211111111111111111211131111111211111111111121111211111211111
1111111111111111111311111111211131111111111112111111111122111111
1111111121111111131311111311111111113111121111111111111211111111
1121111111112111111111112211111111111112111111111111111131111111
1121111131313311112111111212121111111121111111131111311111131111
'''

groundstr = groundstr.replace('-','')
groundstr = groundstr.replace('\n','')
groundstr = groundstr.replace('.','0')

ground = []
for c in groundstr:
    ground.append(int(c))

from pixel_hat import HatFrame
import random

def new_flakes(n):
    for _ in range(random.randint(n[0],n[1])):
        x = random.randint(0,63)
        c = random.randint(1,3)
        ground[x] = c                

with open('snowGEN','w') as ps:
    for i in range(120):
        
        frame = HatFrame()
        cpos = 1
        for j in range(12):
            frame.set_ring(j,cpos+3)
            cpos += 1
            if cpos==4:
                cpos = 1       
        for y in range(24):
            for x in range(64):
                c = ground[y*64+x]                
                frame.set_pixel(x,y,c)
        ps.write(frame.to_string())
        
        for y in range(24):
            for x in range(64):
                c = ground[y*64+x]                
                frame.set_pixel(x,y,c)
        ps.write(frame.to_string())
        
        for x in range(0,64):
            for y in range(20,-1,-1):
                if ground[y*64+x]!=0 and ground[(y+1)*64+x]==0:
                    ground[(y+1)*64+x] = ground[y*64+x]
                    ground[y*64+x] = 0
        
        if i<100:
            new_flakes([5,8])

